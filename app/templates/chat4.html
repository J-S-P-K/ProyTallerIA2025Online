<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatBot</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function() {
            // Detecta si est√° en Render o local
            var socketUrl =
                window.location.hostname === "localhost" || window.location.hostname === "127.0.0.1"
                    ? "http://127.0.0.1:5000"
                    : window.location.origin;

            // Conecta con el servidor Socket.IO
            var socket = io(socketUrl, { transports: ["websocket", "polling"] });

            socket.on('connect', function() {
                socket.emit('my_event', { data: "I'm connected!" });
                $('#log').append('<br>Conectado al servidor');
            });

            socket.on('my_response', function(msg, cb) {
                var respuesta = msg && msg.data ? msg.data : "hola";
                $('#log').append('<br>' + $('<div/>').text(respuesta).html());
                if (cb) cb();
            });

            $('form#emit').submit(function(event) {
                var texto = $('#emit_data').val();
                if (texto.trim() !== "") {
                    socket.emit('my_event', { data: texto });
                    $("#emit_data").val("");
                }
                return false;
            });

            $('form#disconnect').submit(function(event) {
                socket.emit('disconnect_request');
                return false;
            });
        });
    </script>
</head>
<body>
    <h1>Chatbot</h1>

    <div>
        <h2>Recibido:</h2>
        <div id="log"></div>
    </div>

    <form id="emit" method="POST" action="#">
        <input type="text" name="emit_data" id="emit_data" placeholder="Escriba su pregunta...">
        <input id="input_chat" type="submit" value="Preguntar">
    </form>
</body>
</html>
